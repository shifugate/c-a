<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@3.3.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
	<script>
		/*AFRAME.registerComponent('vidhandler', {
			init: function () {
				var marker = this.el;
				
				this.vid = document.querySelector('#ca-video');
				
				marker.addEventListener(
					"markerFound",
					function () {
						this.vid.play();
					}.bind(this)
				);
				
				marker.addEventListener(
					"markerLost",
					function () {
						this.vid.pause();
						this.vid.currTime = 0;
					}.bind(this)
				);
			}
		});*/
		
		AFRAME.registerComponent('vidhandler', {
		  init: function () {
			this.el.sceneEl.addEventListener('enter-vr', (ev) => {
			if (this.el.sceneEl.is('ar-mode')) {
			  this.el.setAttribute('visible', false);
			}
			});
			this.el.sceneEl.addEventListener('exit-vr', (ev) => {
			this.el.setAttribute('visible', true);
			});
		  }
		})
		
		window.addEventListener('click', function () {
		  var preload = document.querySelector('#ca-video');
		  preload.play();
		});
	</script>
  </head>  
  <body>

    <a-scene webxr="optionalFeatures: hit-test;">
      <a-assets timeout="30000">
        <video id="ca-video" muted preload loop playsinline src="video.mp4"></video>
      </a-assets>
      
      <a-camera position="0 10 10"></a-camera>
      
      <a-entity rotation="0 0 0">
		<a-entity scale="1 1 1">
			<a-video src="#ca-video" width="512" height="288" position="0 10 -500" vidhandler></a-video>
		</a-entity>
	  </a-entity>
	  
	  <a-entity ar-hit-test="doHitTest:false" visible="false">
		<a-plane
		 rotation="-90 0 0"
		 width="0.2"
		 height="0.2"
		 src="./arrow.png"
		 material="transparent:true;"
		></a-plane>
	  </a-entity>
    </a-scene>

    <div id="text">
      <p>
        <a href="https://developers.google.com/ar/discover/supported-devices">ARCore-compatible</a>
      </p>
    </div>
  </body>
</html>